---
import { Icon } from "astro-icon/components";

export interface Props {
  /** Search placeholder text */
  placeholder?: string;
  /** Show search suggestions */
  showSuggestions?: boolean;
  /** Show search filters */
  showFilters?: boolean;
  /** Show recent searches */
  showRecentSearches?: boolean;
  /** Show category selector */
  showCategorySelector?: boolean;
  /** Search bar size */
  size?: "sm" | "md" | "lg";
  /** Custom classes */
  class?: string;
  /** Show voice search */
  showVoiceSearch?: boolean;
  /** Show barcode scanner */
  showBarcodeScanner?: boolean;
}

const { 
  placeholder = "Search for products, brands, categories...",
  showSuggestions = true,
  showFilters = true,
  showRecentSearches = true,
  showCategorySelector = true,
  size = "md",
  class: className = "",
  showVoiceSearch = true,
  showBarcodeScanner = true
} = Astro.props;

const sizeClasses = {
  sm: "py-2 px-4 text-sm",
  md: "py-3 px-6 text-base",
  lg: "py-4 px-8 text-lg"
};

// Sample data
const categories = ["All Categories", "Electronics", "Software", "Hardware", "Accessories"];
const suggestions = [
  "wireless headphones",
  "laptop stand",
  "mechanical keyboard",
  "4K monitor",
  "gaming mouse",
  "USB-C cable"
];
const recentSearches = [
  "iPhone 15 Pro",
  "MacBook Air M2",
  "Sony WH-1000XM5",
  "iPad Pro 12.9"
];
const trendingSearches = [
  "Black Friday deals",
  "gaming setup",
  "work from home",
  "smart home devices"
];
---

<div class={`relative ${className}`}>
  <!-- Main Search Bar -->
  <div class="wireframe-box doodle-border overflow-hidden">
    <div class="flex items-center">
      <!-- Category Selector -->
      {showCategorySelector && (
        <div class="flex-shrink-0 border-r" style="border-color: var(--color-theme-stroke);">
          <select class={`${sizeClasses[size]} pr-8 wireframe-text appearance-none cursor-pointer hover:opacity-80 transition-opacity`}
                  style="background-color: var(--color-theme-quaternary);">
            {categories.map((category) => (
              <option value={category}>{category}</option>
            ))}
          </select>
          <Icon name="bx:bx-chevron-down" class="absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 pointer-events-none" 
                style="color: var(--color-theme-tertiary);" />
        </div>
      )}

      <!-- Search Input -->
      <div class="flex-1 relative">
        <input 
          type="text" 
          placeholder={placeholder}
          class={`w-full ${sizeClasses[size]} wireframe-text outline-none`}
          style="background-color: var(--color-theme-bg);"
        />
        
        <!-- Search Icon -->
        <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
          <Icon name="bx:bx-search" class="w-5 h-5" style="color: var(--color-theme-tertiary);" />
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex items-center gap-2 px-3">
        {showVoiceSearch && (
          <button class="p-2 hover:opacity-70 transition-opacity" title="Voice Search">
            <Icon name="bx:bx-microphone" class="w-5 h-5" style="color: var(--color-theme-tertiary);" />
          </button>
        )}
        
        {showBarcodeScanner && (
          <button class="p-2 hover:opacity-70 transition-opacity" title="Scan Barcode">
            <Icon name="bx:bx-qr-scan" class="w-5 h-5" style="color: var(--color-theme-tertiary);" />
          </button>
        )}

        {showFilters && (
          <button class="p-2 hover:opacity-70 transition-opacity" title="Advanced Filters">
            <Icon name="bx:bx-filter" class="w-5 h-5" style="color: var(--color-theme-tertiary);" />
          </button>
        )}

        <!-- Search Button -->
        <button class="px-6 py-2 rounded-lg transition-all hover:opacity-90"
                style="background-color: var(--color-theme-button); color: var(--color-theme-button-text);">
          <Icon name="bx:bx-search" class="w-5 h-5" />
        </button>
      </div>
    </div>
  </div>

  <!-- Search Suggestions Dropdown -->
  {showSuggestions && (
    <div class="absolute top-full left-0 right-0 mt-2 wireframe-box doodle-border z-50 max-h-96 overflow-y-auto"
         style="background-color: var(--color-theme-card-bg);">
      
      <!-- Search Suggestions -->
      <div class="p-4">
        <div class="flex items-center gap-2 mb-3">
          <Icon name="bx:bx-trending-up" class="w-4 h-4" style="color: var(--color-theme-button);" />
          <h4 class="wireframe-heading text-sm">Popular Searches</h4>
        </div>
        <div class="space-y-2">
          {suggestions.map((suggestion) => (
            <button class="flex items-center gap-3 w-full p-2 rounded-lg hover:opacity-80 transition-opacity text-left"
                    style="background-color: var(--color-theme-quaternary);">
              <Icon name="bx:bx-search" class="w-4 h-4" style="color: var(--color-theme-tertiary);" />
              <span class="wireframe-text">{suggestion}</span>
              <Icon name="bx:bx-trending-up" class="w-4 h-4 ml-auto" style="color: var(--color-theme-secondary);" />
            </button>
          ))}
        </div>
      </div>

      {showRecentSearches && (
        <div class="p-4 border-t" style="border-color: var(--color-theme-stroke);">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
              <Icon name="bx:bx-history" class="w-4 h-4" style="color: var(--color-theme-tertiary);" />
              <h4 class="wireframe-heading text-sm">Recent Searches</h4>
            </div>
            <button class="wireframe-text text-xs hover:opacity-70 transition-opacity"
                    style="color: var(--color-theme-button);">
              Clear
            </button>
          </div>
          <div class="space-y-2">
            {recentSearches.map((search) => (
              <button class="flex items-center gap-3 w-full p-2 rounded-lg hover:opacity-80 transition-opacity text-left">
                <Icon name="bx:bx-history" class="w-4 h-4" style="color: var(--color-theme-tertiary);" />
                <span class="wireframe-text">{search}</span>
                <Icon name="bx:bx-x" class="w-4 h-4 ml-auto hover:opacity-70" style="color: var(--color-theme-tertiary);" />
              </button>
            ))}
          </div>
        </div>
      )}

      <!-- Trending Categories -->
      <div class="p-4 border-t" style="border-color: var(--color-theme-stroke);">
        <div class="flex items-center gap-2 mb-3">
          <Icon name="bx:bx-category" class="w-4 h-4" style="color: var(--color-theme-button);" />
          <h4 class="wireframe-heading text-sm">Trending Categories</h4>
        </div>
        <div class="flex flex-wrap gap-2">
          {trendingSearches.map((trend) => (
            <button class="px-3 py-1 text-sm rounded-full wireframe-box doodle-border hover:opacity-80 transition-opacity">
              <span class="wireframe-text">{trend}</span>
            </button>
          ))}
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="p-4 border-t" style="border-color: var(--color-theme-stroke);">
        <div class="grid grid-cols-2 gap-3">
          <button class="flex items-center gap-2 p-3 rounded-lg wireframe-box doodle-border hover:opacity-80 transition-opacity">
            <Icon name="bx:bx-scan" class="w-5 h-5" style="color: var(--color-theme-button);" />
            <div class="text-left">
              <p class="wireframe-heading text-sm">Scan Product</p>
              <p class="wireframe-text text-xs" style="color: var(--color-theme-tertiary);">Use camera</p>
            </div>
          </button>
          <button class="flex items-center gap-2 p-3 rounded-lg wireframe-box doodle-border hover:opacity-80 transition-opacity">
            <Icon name="bx:bx-map" class="w-5 h-5" style="color: var(--color-theme-button);" />
            <div class="text-left">
              <p class="wireframe-heading text-sm">Store Locator</p>
              <p class="wireframe-text text-xs" style="color: var(--color-theme-tertiary);">Find nearby</p>
            </div>
          </button>
        </div>
      </div>
    </div>
  )}
</div>