---
import { Icon } from "astro-icon/components";

export interface Props {
  /** Title for the security section */
  title?: string;
  /** Security badges to display */
  badges?: Array<{
    id: string;
    name: string;
    icon: string;
    description?: string;
    color?: string;
  }>;
  /** Trust indicators */
  trustIndicators?: Array<{
    id: string;
    text: string;
    icon: string;
  }>;
  /** Show customer reviews summary */
  showReviews?: boolean;
  /** Reviews data */
  reviews?: {
    rating: number;
    count: number;
    text?: string;
  };
  /** Layout variant */
  layout?: "horizontal" | "vertical" | "grid";
  /** Custom classes */
  class?: string;
  /** Size variant */
  size?: "sm" | "md" | "lg";
}

const { 
  title,
  badges = [
    {
      id: "ssl",
      name: "SSL Secured",
      icon: "bx:bx-check-shield",
      description: "256-bit encryption protects your data",
      color: "var(--color-theme-button)"
    },
    {
      id: "pci",
      name: "PCI Compliant",
      icon: "bx:bx-credit-card",
      description: "Meets payment card industry standards",
      color: "var(--color-theme-button)"
    },
    {
      id: "gdpr",
      name: "GDPR Compliant",
      icon: "bx:bx-check-shield",
      description: "Respects your privacy rights",
      color: "var(--color-theme-button)"
    },
    {
      id: "money_back",
      name: "Money Back Guarantee",
      icon: "bx:bx-money-withdraw",
      description: "30-day refund policy",
      color: "var(--color-theme-button)"
    }
  ],
  trustIndicators = [
    {
      id: "support",
      text: "24/7 Customer Support",
      icon: "bx:bx-support"
    },
    {
      id: "uptime",
      text: "99.9% Uptime SLA",
      icon: "bx:bx-time"
    },
    {
      id: "backup",
      text: "Daily Automated Backups",
      icon: "bx:bx-cloud"
    }
  ],
  showReviews = true,
  reviews = {
    rating: 4.8,
    count: 12847,
    text: "customers trust our platform"
  },
  layout = "horizontal",
  class: className = "",
  size = "md"
} = Astro.props;

// Size configurations
const sizeConfig = {
  sm: {
    badge: "p-3",
    icon: "w-4 h-4",
    title: "text-sm",
    description: "text-xs",
    trustText: "text-xs"
  },
  md: {
    badge: "p-4",
    icon: "w-5 h-5",
    title: "text-base",
    description: "text-sm",
    trustText: "text-sm"
  },
  lg: {
    badge: "p-6",
    icon: "w-6 h-6",
    title: "text-lg",
    description: "text-base", 
    trustText: "text-base"
  }
};

const config = sizeConfig[size];

// Generate star rating display
const generateStars = (rating: number) => {
  const fullStars = Math.floor(rating);
  const hasHalfStar = rating % 1 >= 0.5;
  const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
  
  return {
    full: fullStars,
    half: hasHalfStar,
    empty: emptyStars
  };
};

const starData = reviews ? generateStars(reviews.rating) : null;
---

<div class={`security-badges ${className}`}>
  {title && (
    <h3 class="wireframe-heading text-xl mb-6 text-center">{title}</h3>
  )}

  {layout === "horizontal" ? (
    <!-- Horizontal Layout -->
    <div class="space-y-8">
      
      <!-- Security Badges -->
      <div class="flex flex-wrap justify-center gap-4">
        {badges.map((badge) => (
          <div class={`wireframe-box doodle-border ${config.badge} text-center flex-shrink-0 min-w-0 hover:opacity-80 transition-opacity`}>
            <Icon name={badge.icon} class={`${config.icon} mx-auto mb-2`} style={`color: ${badge.color};`} />
            <div class={`wireframe-text font-medium ${config.title} mb-1`}>
              {badge.name}
            </div>
            {badge.description && (
              <p class={`wireframe-text ${config.description}`} style="color: var(--color-theme-tertiary);">
                {badge.description}
              </p>
            )}
          </div>
        ))}
      </div>

      <!-- Trust Indicators -->
      <div class="flex flex-wrap justify-center gap-6">
        {trustIndicators.map((indicator) => (
          <div class="flex items-center gap-2">
            <Icon name={indicator.icon} class="w-4 h-4" style="color: var(--color-theme-button);" />
            <span class={`wireframe-text ${config.trustText}`}>{indicator.text}</span>
          </div>
        ))}
      </div>

      <!-- Customer Reviews -->
      {showReviews && reviews && (
        <div class="text-center">
          <div class="flex items-center justify-center gap-2 mb-2">
            <!-- Star Rating -->
            <div class="flex items-center gap-1">
              {starData && (
                <>
                  {Array.from({ length: starData.full }, (_, i) => (
                    <Icon name="bx:bxs-star" class="w-4 h-4" style="color: #fbbf24;" key={`full-${i}`} />
                  ))}
                  {starData.half && (
                    <Icon name="bx:bxs-star-half" class="w-4 h-4" style="color: #fbbf24;" />
                  )}
                  {Array.from({ length: starData.empty }, (_, i) => (
                    <Icon name="bx:bx-star" class="w-4 h-4" style="color: #d1d5db;" key={`empty-${i}`} />
                  ))}
                </>
              )}
            </div>
            <span class="wireframe-text font-medium">{reviews.rating}</span>
            <span class="wireframe-text" style="color: var(--color-theme-tertiary);">
              ({reviews.count.toLocaleString()})
            </span>
          </div>
          {reviews.text && (
            <p class={`wireframe-text ${config.trustText}`} style="color: var(--color-theme-tertiary);">
              {reviews.text}
            </p>
          )}
        </div>
      )}
    </div>
  ) : layout === "vertical" ? (
    <!-- Vertical Layout -->
    <div class="space-y-6">
      {badges.map((badge) => (
        <div class={`wireframe-box doodle-border ${config.badge} flex items-center gap-4 hover:opacity-80 transition-opacity`}>
          <Icon name={badge.icon} class={config.icon} style={`color: ${badge.color};`} />
          <div class="flex-grow">
            <div class={`wireframe-text font-medium ${config.title} mb-1`}>
              {badge.name}
            </div>
            {badge.description && (
              <p class={`wireframe-text ${config.description}`} style="color: var(--color-theme-tertiary);">
                {badge.description}
              </p>
            )}
          </div>
        </div>
      ))}

      <!-- Trust Indicators (Vertical) -->
      <div class="space-y-3 pt-4 border-t" style="border-color: var(--color-theme-stroke);">
        {trustIndicators.map((indicator) => (
          <div class="flex items-center gap-3">
            <Icon name={indicator.icon} class="w-4 h-4" style="color: var(--color-theme-button);" />
            <span class={`wireframe-text ${config.trustText}`}>{indicator.text}</span>
          </div>
        ))}
      </div>

      <!-- Customer Reviews (Vertical) -->
      {showReviews && reviews && (
        <div class="pt-4 border-t text-center" style="border-color: var(--color-theme-stroke);">
          <div class="flex items-center justify-center gap-2 mb-2">
            <div class="flex items-center gap-1">
              {starData && (
                <>
                  {Array.from({ length: starData.full }, (_, i) => (
                    <Icon name="bx:bxs-star" class="w-4 h-4" style="color: #fbbf24;" key={`full-${i}`} />
                  ))}
                  {starData.half && (
                    <Icon name="bx:bxs-star-half" class="w-4 h-4" style="color: #fbbf24;" />
                  )}
                  {Array.from({ length: starData.empty }, (_, i) => (
                    <Icon name="bx:bx-star" class="w-4 h-4" style="color: #d1d5db;" key={`empty-${i}`} />
                  ))}
                </>
              )}
            </div>
            <span class="wireframe-text font-medium">{reviews.rating}</span>
          </div>
          <p class={`wireframe-text ${config.trustText}`} style="color: var(--color-theme-tertiary);">
            {reviews.count.toLocaleString()} {reviews.text}
          </p>
        </div>
      )}
    </div>
  ) : (
    <!-- Grid Layout -->
    <div class="space-y-8">
      <!-- Security Badges Grid -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {badges.map((badge) => (
          <div class={`wireframe-box doodle-border ${config.badge} text-center hover:opacity-80 transition-opacity`}>
            <Icon name={badge.icon} class={`${config.icon} mx-auto mb-2`} style={`color: ${badge.color};`} />
            <div class={`wireframe-text font-medium ${config.title} mb-1`}>
              {badge.name}
            </div>
            {badge.description && (
              <p class={`wireframe-text ${config.description}`} style="color: var(--color-theme-tertiary);">
                {badge.description}
              </p>
            )}
          </div>
        ))}
      </div>

      <!-- Bottom Section -->
      <div class="grid md:grid-cols-2 gap-8 items-center">
        <!-- Trust Indicators -->
        <div class="space-y-3">
          {trustIndicators.map((indicator) => (
            <div class="flex items-center gap-3">
              <Icon name={indicator.icon} class="w-4 h-4" style="color: var(--color-theme-button);" />
              <span class={`wireframe-text ${config.trustText}`}>{indicator.text}</span>
            </div>
          ))}
        </div>

        <!-- Customer Reviews -->
        {showReviews && reviews && (
          <div class="text-center md:text-left">
            <div class="flex items-center justify-center md:justify-start gap-2 mb-2">
              <div class="flex items-center gap-1">
                {starData && (
                  <>
                    {Array.from({ length: starData.full }, (_, i) => (
                      <Icon name="bx:bxs-star" class="w-4 h-4" style="color: #fbbf24;" key={`full-${i}`} />
                    ))}
                    {starData.half && (
                      <Icon name="bx:bxs-star-half" class="w-4 h-4" style="color: #fbbf24;" />
                    )}
                    {Array.from({ length: starData.empty }, (_, i) => (
                      <Icon name="bx:bx-star" class="w-4 h-4" style="color: #d1d5db;" key={`empty-${i}`} />
                    ))}
                  </>
                )}
              </div>
              <span class="wireframe-text font-medium">{reviews.rating}</span>
            </div>
            <p class={`wireframe-text ${config.trustText}`} style="color: var(--color-theme-tertiary);">
              {reviews.count.toLocaleString()} {reviews.text}
            </p>
          </div>
        )}
      </div>
    </div>
  )}

  <!-- Additional Security Notice -->
  <div class="mt-8 text-center">
    <div class="wireframe-box doodle-border p-4" style="background-color: var(--color-theme-quaternary);">
      <div class="flex items-center justify-center gap-3 mb-2">
        <Icon name="bx:bx-check-shield" class="w-5 h-5" style="color: var(--color-theme-button);" />
        <span class="wireframe-text font-medium">Your information is protected</span>
      </div>
      <p class={`wireframe-text ${config.description}`} style="color: var(--color-theme-tertiary);">
        We use industry-standard security measures to protect your personal and payment information. 
        Your data is encrypted and never stored on our servers.
      </p>
    </div>
  </div>

  <!-- Security Certifications -->
  <div class="mt-6 text-center">
    <p class={`wireframe-text ${config.trustText} mb-4`} style="color: var(--color-theme-tertiary);">
      Certified by leading security organizations
    </p>
    <div class="flex justify-center items-center gap-6 flex-wrap">
      <!-- Certification Badges -->
      <div class="flex items-center gap-2">
        <Icon name="bx:bx-shield" class="w-4 h-4" style="color: var(--color-theme-tertiary);" />
        <span class={`wireframe-text ${config.trustText}`} style="color: var(--color-theme-tertiary);">
          ISO 27001
        </span>
      </div>
      <div class="flex items-center gap-2">
        <Icon name="bx:bx-check-circle" class="w-4 h-4" style="color: var(--color-theme-tertiary);" />
        <span class={`wireframe-text ${config.trustText}`} style="color: var(--color-theme-tertiary);">
          SOC 2 Type II
        </span>
      </div>
      <div class="flex items-center gap-2">
        <Icon name="bx:bx-lock" class="w-4 h-4" style="color: var(--color-theme-tertiary);" />
        <span class={`wireframe-text ${config.trustText}`} style="color: var(--color-theme-tertiary);">
          GDPR Ready
        </span>
      </div>
    </div>
  </div>
</div>

<style>
  /* Hover effects */
  .security-badges .wireframe-box:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  
  /* Transition effects */
  .security-badges .wireframe-box {
    transition: all 0.2s ease;
  }
  
  /* Star rating animations */
  .security-badges [name*="star"] {
    transition: all 0.2s ease;
  }
  
  .security-badges [name*="star"]:hover {
    transform: scale(1.1);
  }
</style>